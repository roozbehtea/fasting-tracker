<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Fasting Tracker - Cloud Sync</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Auth Screen Styles */
        .auth-container {
            max-width: 450px;
            margin: 50px auto;
        }
        
        .auth-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .auth-logo {
            text-align: center;
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .auth-title {
            text-align: center;
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .auth-subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #667eea;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .auth-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-auth {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-google {
            background: white;
            color: #333;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-google:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }
        
        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }
        
        .auth-switch a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }
        
        .auth-switch a:hover {
            text-decoration: underline;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        .success-message {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
        }
        
        .success-message.show {
            display: block;
        }
        
        /* Main App Styles */
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .user-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-email {
            color: #666;
            font-size: 0.9em;
        }
        
        .btn-logout {
            padding: 10px 20px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-logout:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            color: #667eea;
        }
        
        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
        }
        
        .timer {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            margin: 30px 0;
            color: #667eea;
            font-variant-numeric: tabular-nums;
        }
        
        .zone-progress {
            margin: 30px 0;
        }
        
        .zone {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .zone.active {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .zone.completed {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .zone.pending {
            background: #f5f5f5;
            color: #999;
        }
        
        .zone-icon {
            font-size: 2em;
            margin-right: 15px;
            min-width: 50px;
            text-align: center;
        }
        
        .zone-info {
            flex: 1;
        }
        
        .zone-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }
        
        .zone-time {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .zone-description {
            font-size: 0.85em;
            margin-top: 5px;
            opacity: 0.9;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #666;
            flex: 1;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
            flex: 1;
        }
        
        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        
        .btn-success:hover {
            background: #45a049;
        }
        
        .profile-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .profile-item {
            text-align: center;
        }
        
        .profile-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .profile-value {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .insights {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .insights h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .insight-item {
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .insight-item:last-child {
            border-bottom: none;
        }
        
        .no-fast-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        
        .no-fast-state h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .fast-history {
            margin-top: 20px;
        }
        
        .fast-entry {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }
        
        .fast-entry:hover {
            background: #e9ecef;
        }
        
        .fast-details {
            flex: 1;
        }
        
        .fast-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .fast-duration {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }
        
        .fast-zone {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .zone-badge-anabolic {
            background: #E3F2FD;
            color: #1976D2;
        }
        
        .zone-badge-catabolic {
            background: #FFF3E0;
            color: #F57C00;
        }
        
        .zone-badge-fatburn {
            background: #FFEBEE;
            color: #C62828;
        }
        
        .zone-badge-ketosis {
            background: #F3E5F5;
            color: #7B1FA2;
        }
        
        .zone-badge-deep {
            background: #E8EAF6;
            color: #283593;
        }
        
        .fast-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: auto;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        .cloud-sync-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #4CAF50;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .sync-status {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .timer {
                font-size: 3em;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .fast-entry {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .fast-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .user-header {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading hidden">
        <div class="spinner"></div>
        <p>Loading your data...</p>
    </div>
    
    <!-- Auth Screen -->
    <div id="auth-screen" class="auth-container">
        <div class="auth-card">
            <div class="auth-logo">üïê</div>
            <h1 class="auth-title">Fasting Tracker</h1>
            <p class="auth-subtitle">Track your fasting journey with cloud sync</p>
            
            <div id="error-message" class="error-message"></div>
            <div id="success-message" class="success-message"></div>
            
            <!-- Login Form -->
            <div id="login-form">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="auth-buttons">
                    <button class="btn-auth btn-primary" onclick="loginUser()">Sign In</button>
                </div>
                <div class="auth-switch">
                    Don't have an account? <a href="#" onclick="showSignup(); return false;">Sign up</a>
                </div>
            </div>
            
            <!-- Signup Form -->
            <div id="signup-form" class="hidden">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signup-email" placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signup-password" placeholder="At least 6 characters">
                </div>
                <div class="form-group">
                    <label>Confirm Password</label>
                    <input type="password" id="signup-password-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="auth-buttons">
                    <button class="btn-auth btn-primary" onclick="signupUser()">Create Account</button>
                </div>
                <div class="auth-switch">
                    Already have an account? <a href="#" onclick="showLogin(); return false;">Sign in</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="main-app" class="container hidden">
        <!-- User Header -->
        <div class="user-header">
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">U</div>
                <div class="user-details">
                    <div><strong id="user-name">User</strong> <span class="cloud-sync-badge">‚òÅÔ∏è Synced</span></div>
                    <div class="user-email" id="user-email">user@example.com</div>
                </div>
            </div>
            <button class="btn-logout" onclick="logoutUser()">Sign Out</button>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab active" onclick="switchTab('current')">üïê Current Fast</button>
            <button class="tab" onclick="switchTab('history')">üìã History</button>
            <button class="tab" onclick="switchTab('stats')">üìä Statistics</button>
            <button class="tab" onclick="switchTab('profile')">üë§ Profile</button>
        </div>
        
        <!-- Current Fast Tab -->
        <div id="tab-current" class="tab-content active">
            <div class="card">
                <div id="no-fast-message" class="no-fast-state" style="display: none;">
                    <h3>No Active Fast</h3>
                    <p>Start a new fast to begin tracking your progress</p>
                    <button class="btn-primary" onclick="startNewFast()" style="margin-top: 20px;">üöÄ Start New Fast</button>
                </div>
                
                <div id="active-fast-content">
                    <h1>üïê Current Fast</h1>
                    <p id="fast-start-info" style="color: #666;">Started: --</p>
                    
                    <div class="profile-info">
                        <h3 style="margin-bottom: 10px;">Your Profile</h3>
                        <div class="profile-grid">
                            <div class="profile-item">
                                <div class="profile-label">Weight</div>
                                <div class="profile-value" id="current-weight">220 lbs</div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-label">Height</div>
                                <div class="profile-value" id="current-height">5'5"</div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-label">Body Fat</div>
                                <div class="profile-value" id="current-bodyfat">37%</div>
                            </div>
                            <div class="profile-item">
                                <div class="profile-label">BMI</div>
                                <div class="profile-value" id="current-bmi">36.6</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="timer" id="timer">00:00:00</div>
                    
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-label">Hours Fasted</div>
                            <div class="stat-value" id="hours-fasted">0</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Current Zone</div>
                            <div class="stat-value" id="current-zone" style="font-size: 1.3em;">Anabolic</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Est. Calories Burned</div>
                            <div class="stat-value" id="calories-burned">0</div>
                        </div>
                    </div>
                    
                    <div class="zone-progress">
                        <h2>Metabolic Zones</h2>
                        
                        <div class="zone" id="zone-anabolic">
                            <div class="zone-icon">üçΩÔ∏è</div>
                            <div class="zone-info">
                                <div class="zone-name">Anabolic (Building)</div>
                                <div class="zone-time">0-4 hours</div>
                                <div class="zone-description">Body is digesting and storing energy from your meal</div>
                            </div>
                        </div>
                        
                        <div class="zone" id="zone-catabolic">
                            <div class="zone-icon">‚ö°</div>
                            <div class="zone-info">
                                <div class="zone-name">Catabolic (Breakdown)</div>
                                <div class="zone-time">4-12 hours</div>
                                <div class="zone-description">Glycogen stores being depleted, insulin levels dropping</div>
                            </div>
                        </div>
                        
                        <div class="zone" id="zone-fatburn">
                            <div class="zone-icon">üî•</div>
                            <div class="zone-info">
                                <div class="zone-name">Fat Burning</div>
                                <div class="zone-time">12-16 hours</div>
                                <div class="zone-description">Body shifts to burning fat for fuel, ketone production begins</div>
                            </div>
                        </div>
                        
                        <div class="zone" id="zone-ketosis">
                            <div class="zone-icon">‚öóÔ∏è</div>
                            <div class="zone-info">
                                <div class="zone-name">Ketosis</div>
                                <div class="zone-time">16-24 hours</div>
                                <div class="zone-description">Significant ketone production, enhanced mental clarity</div>
                            </div>
                        </div>
                        
                        <div class="zone" id="zone-deep">
                            <div class="zone-icon">üß¨</div>
                            <div class="zone-info">
                                <div class="zone-name">Deep Ketosis & Autophagy</div>
                                <div class="zone-time">24+ hours</div>
                                <div class="zone-description">Cellular cleanup intensifies, autophagy peaks, HGH increases</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="insights">
                        <h3>üí° Real-Time Insights</h3>
                        <div id="insights-content">
                            <div class="insight-item">
                                <strong>Current Status:</strong> <span id="insight-status">Your body is in the early digestion phase.</span>
                            </div>
                            <div class="insight-item">
                                <strong>With your body composition:</strong> <span id="insight-composition">You have fat mass available for fuel.</span>
                            </div>
                            <div class="insight-item">
                                <strong>Recommendation:</strong> <span id="insight-recommendation">Stay hydrated.</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button class="btn-secondary" onclick="openNoteModal()">üìù Add Note</button>
                        <button class="btn-primary" onclick="openGoalModal()">üéØ Set Goal</button>
                        <button class="btn-secondary" onclick="cancelFast()">‚ùå Cancel Fast</button>
                        <button class="btn-danger" onclick="endFast()">üç¥ End & Save Fast</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- History Tab -->
        <div id="tab-history" class="tab-content">
            <div class="card">
                <h1>üìã Fasting History</h1>
                <p style="color: #666; margin-bottom: 20px;">Complete log of all your fasts - synced across all devices</p>
                
                <div class="button-group" style="margin-bottom: 20px;">
                    <button class="btn-primary" onclick="startNewFast()">üöÄ Start New Fast</button>
                    <button class="btn-secondary" onclick="exportToExcel()">üì• Export to Excel</button>
                </div>
                
                <div id="fast-history-list" class="fast-history">
                    <!-- Fast entries will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Statistics Tab -->
        <div id="tab-stats" class="tab-content">
            <div class="card">
                <h1>üìä Statistics & Progress</h1>
                <p style="color: #666; margin-bottom: 20px;">Your fasting journey at a glance</p>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Total Fasts</div>
                        <div class="stat-value" id="stat-total-fasts">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Current Streak</div>
                        <div class="stat-value" id="stat-streak">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Avg Duration</div>
                        <div class="stat-value" id="stat-avg-duration">0h</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Longest Fast</div>
                        <div class="stat-value" id="stat-longest">0h</div>
                    </div>
                </div>
                
                <h2>Weight Progress</h2>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label">Starting Weight</div>
                        <div class="stat-value" id="stat-start-weight">220</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Current Weight</div>
                        <div class="stat-value" id="stat-current-weight">220</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Total Lost</div>
                        <div class="stat-value" id="stat-weight-lost">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">BMI Change</div>
                        <div class="stat-value" id="stat-bmi-change">0</div>
                    </div>
                </div>
                
                <h2>Zone Achievements</h2>
                <div class="chart-container">
                    <div>
                        <strong>Fat Burning Zone (12+ hrs):</strong>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fatburn" style="width: 0%">0 times</div>
                        </div>
                    </div>
                    <div>
                        <strong>Ketosis Zone (16+ hrs):</strong>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-ketosis" style="width: 0%">0 times</div>
                        </div>
                    </div>
                    <div>
                        <strong>Deep Ketosis (24+ hrs):</strong>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-deep" style="width: 0%">0 times</div>
                        </div>
                    </div>
                </div>
                
                <h2>Total Hours Fasted</h2>
                <div class="stat-box" style="max-width: 400px;">
                    <div class="stat-label">Lifetime Total</div>
                    <div class="stat-value" id="stat-total-hours">0</div>
                    <div style="margin-top: 10px; font-size: 0.9em;">That's <span id="stat-total-days">0</span> days!</div>
                </div>
            </div>
        </div>
        
        <!-- Profile Tab -->
        <div id="tab-profile" class="tab-content">
            <div class="card">
                <h1>üë§ Profile Settings</h1>
                <p style="color: #666; margin-bottom: 20px;">Update your personal information - syncs automatically</p>
                
                <div class="form-group">
                    <label>Weight (lbs)</label>
                    <input type="number" id="profile-weight" value="220" step="0.1">
                </div>
                
                <div class="form-group">
                    <label>Height (inches)</label>
                    <input type="number" id="profile-height" value="65" step="1">
                </div>
                
                <div class="form-group">
                    <label>Body Fat Percentage</label>
                    <input type="number" id="profile-bodyfat" value="37" step="0.1" min="0" max="100">
                </div>
                
                <div class="form-group">
                    <label>Age</label>
                    <input type="number" id="profile-age" value="35" step="1" min="1" max="120">
                </div>
                
                <div class="form-group">
                    <label>Gender</label>
                    <select id="profile-gender">
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button class="btn-primary" onclick="saveProfile()">üíæ Save Profile</button>
                </div>
                
                <div id="profile-alert" class="success-message"></div>
                
                <h2>Cloud Sync Status</h2>
                <div class="insights">
                    <p><strong>‚úÖ Connected:</strong> Your data is automatically syncing to the cloud</p>
                    <p><strong>üîí Secure:</strong> Your data is encrypted and only accessible by you</p>
                    <p><strong>üì± Multi-Device:</strong> Access your data from any device by signing in</p>
                    <p><strong>üíæ Backup:</strong> Your data is automatically backed up in the cloud</p>
                    <div class="sync-status" id="sync-status">Last synced: Just now</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="note-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Note</h2>
                <button class="modal-close" onclick="closeModal('note-modal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Note</label>
                <textarea id="note-text" placeholder="How are you feeling? Any observations?"></textarea>
            </div>
            <button class="btn-primary" onclick="saveNote()">Save Note</button>
        </div>
    </div>
    
    <div id="goal-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set Fasting Goal</h2>
                <button class="modal-close" onclick="closeModal('goal-modal')">&times;</button>
            </div>
            <div class="form-group">
                <label>Target Duration (hours)</label>
                <input type="number" id="goal-hours" value="16" min="1" max="168">
            </div>
            <div class="insights">
                <p><strong>Common Goals:</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>16 hours - Standard intermittent fasting (16:8)</li>
                    <li>18 hours - Extended fat burning</li>
                    <li>24 hours - OMAD (One Meal A Day)</li>
                    <li>48+ hours - Extended fast (consult healthcare provider)</li>
                </ul>
            </div>
            <button class="btn-primary" onclick="saveGoal()">Set Goal</button>
        </div>
    </div>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // =================================================================
        // ‚ö†Ô∏è FIREBASE CONFIGURATION - YOU NEED TO ADD YOUR CONFIG HERE ‚ö†Ô∏è
        // =================================================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyAD037fOI7q5D2zPoqmvrBj6CPYuv4DJoM",
            authDomain: "fasting-tracker-1b50c.firebaseapp.com",
            databaseURL: "https://fasting-tracker-1b50c-default-rtdb.firebaseio.com",
            projectId: "fasting-tracker-1b50c",
            storageBucket: "fasting-tracker-1b50c.firebasestorage.app",
            messagingSenderId: "564355249",
            appId: "1:564355249:web:20b4c512815804480e0290"
        };
        
        // =================================================================
        // Initialize Firebase
        // =================================================================
        
        let app, auth, database, currentUser = null;
        let currentFast = null;
        let profile = null;
        let fastHistory = [];
        let timerInterval = null;
        let fastGoal = 16;
        
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            database = firebase.database();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
            showError("Firebase configuration error. Please check your config.");
        }
        
        // =================================================================
        // AUTH FUNCTIONS
        // =================================================================
        
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserData();
                showMainApp();
            } else {
                showAuthScreen();
            }
        });
        
        function showAuthScreen() {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('loading-screen').classList.add('hidden');
        }
        
        function showMainApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('loading-screen').classList.add('hidden');
            
            // Update user info
            document.getElementById('user-email').textContent = currentUser.email;
            const userName = currentUser.displayName || currentUser.email.split('@')[0];
            document.getElementById('user-name').textContent = userName;
            document.getElementById('user-avatar').textContent = userName.charAt(0).toUpperCase();
        }
        
        function showLogin() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('signup-form').classList.add('hidden');
            clearMessages();
        }
        
        function showSignup() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
            clearMessages();
        }
        
        async function loginUser() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showError("Please enter email and password");
                return;
            }
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showSuccess("Login successful!");
            } catch (error) {
                showError(getErrorMessage(error.code));
            }
        }
        
        async function signupUser() {
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-password-confirm').value;
            
            if (!email || !password) {
                showError("Please enter email and password");
                return;
            }
            
            if (password.length < 6) {
                showError("Password must be at least 6 characters");
                return;
            }
            
            if (password !== confirmPassword) {
                showError("Passwords don't match");
                return;
            }
            
            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                // Initialize default profile
                await initializeUserProfile(userCredential.user.uid);
                showSuccess("Account created successfully!");
            } catch (error) {
                showError(getErrorMessage(error.code));
            }
        }
        
        async function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                const result = await auth.signInWithPopup(provider);
                // Check if new user
                if (result.additionalUserInfo.isNewUser) {
                    await initializeUserProfile(result.user.uid);
                }
                showSuccess("Login successful!");
            } catch (error) {
                showError(getErrorMessage(error.code));
            }
        }
        
        async function logoutUser() {
            if (confirm("Are you sure you want to sign out?")) {
                try {
                    if (timerInterval) {
                        clearInterval(timerInterval);
                    }
                    await auth.signOut();
                } catch (error) {
                    showError("Error signing out");
                }
            }
        }
        
        function getErrorMessage(code) {
            const messages = {
                'auth/invalid-email': 'Invalid email address',
                'auth/user-disabled': 'This account has been disabled',
                'auth/user-not-found': 'No account found with this email',
                'auth/wrong-password': 'Incorrect password',
                'auth/email-already-in-use': 'Email already in use',
                'auth/weak-password': 'Password is too weak',
                'auth/popup-closed-by-user': 'Sign-in popup was closed',
                'auth/cancelled-popup-request': 'Sign-in was cancelled'
            };
            return messages[code] || 'An error occurred. Please try again.';
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => errorDiv.classList.remove('show'), 5000);
        }
        
        function showSuccess(message) {
            const successDiv = document.getElementById('success-message');
            successDiv.textContent = message;
            successDiv.classList.add('show');
            setTimeout(() => successDiv.classList.remove('show'), 3000);
        }
        
        function clearMessages() {
            document.getElementById('error-message').classList.remove('show');
            document.getElementById('success-message').classList.remove('show');
        }
        
        // =================================================================
        // DATABASE FUNCTIONS
        // =================================================================
        
        async function initializeUserProfile(uid) {
            const defaultProfile = {
                weight: 220,
                height: 65,
                bodyFat: 37,
                age: 35,
                gender: 'male',
                startWeight: 220,
                startDate: new Date().toISOString()
            };
            
            await database.ref(`users/${uid}/profile`).set(defaultProfile);
        }
        
        async function loadUserData() {
            if (!currentUser) return;
            
            document.getElementById('loading-screen').classList.remove('hidden');
            
            try {
                // Load profile
                const profileSnapshot = await database.ref(`users/${currentUser.uid}/profile`).once('value');
                profile = profileSnapshot.val() || {
                    weight: 220,
                    height: 65,
                    bodyFat: 37,
                    age: 35,
                    gender: 'male',
                    startWeight: 220,
                    startDate: new Date().toISOString()
                };
                
                // Load current fast
                const currentFastSnapshot = await database.ref(`users/${currentUser.uid}/currentFast`).once('value');
                currentFast = currentFastSnapshot.val();
                
                // Load history
                const historySnapshot = await database.ref(`users/${currentUser.uid}/history`).once('value');
                fastHistory = historySnapshot.val() ? Object.values(historySnapshot.val()) : [];
                
                // Update UI
                updateProfileDisplay();
                initializeApp();
                
            } catch (error) {
                console.error("Error loading data:", error);
                showError("Error loading your data");
            } finally {
                document.getElementById('loading-screen').classList.add('hidden');
            }
        }
        
        async function saveToFirebase(path, data) {
            if (!currentUser) return;
            try {
                await database.ref(`users/${currentUser.uid}/${path}`).set(data);
                updateSyncStatus();
            } catch (error) {
                console.error("Error saving to Firebase:", error);
            }
        }
        
        function updateSyncStatus() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('sync-status').textContent = `Last synced: ${timeStr}`;
        }
        
        // =================================================================
        // APP FUNCTIONS (Same as before, but with Firebase sync)
        // =================================================================
        
        function initializeApp() {
            // Load profile into form
            document.getElementById('profile-weight').value = profile.weight;
            document.getElementById('profile-height').value = profile.height;
            document.getElementById('profile-bodyfat').value = profile.bodyFat;
            document.getElementById('profile-age').value = profile.age;
            document.getElementById('profile-gender').value = profile.gender;
            
            updateProfileDisplay();
            
            if (currentFast) {
                showActiveFast();
                startTimer();
            } else {
                showNoFastState();
            }
            
            updateHistoryDisplay();
            updateStatisticsDisplay();
        }
        
        function showNoFastState() {
            document.getElementById('no-fast-message').style.display = 'block';
            document.getElementById('active-fast-content').style.display = 'none';
        }
        
        function showActiveFast() {
            document.getElementById('no-fast-message').style.display = 'none';
            document.getElementById('active-fast-content').style.display = 'block';
            
            const startDate = new Date(currentFast.startTime);
            document.getElementById('fast-start-info').textContent = 
                `Started: ${startDate.toLocaleDateString()} at ${startDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'history') {
                updateHistoryDisplay();
            } else if (tabName === 'stats') {
                updateStatisticsDisplay();
            }
        }
        
        async function startNewFast() {
            if (currentFast) {
                if (!confirm('You have an active fast. End it before starting a new one?')) {
                    return;
                }
                await endFast(false);
            }
            
            currentFast = {
                id: Date.now(),
                startTime: new Date().toISOString(),
                startWeight: profile.weight,
                notes: [],
                goal: fastGoal
            };
            
            await saveToFirebase('currentFast', currentFast);
            showActiveFast();
            startTimer();
            switchTab('current');
            
            document.querySelectorAll('.tab').forEach((tab, index) => {
                if (index === 0) tab.classList.add('active');
                else tab.classList.remove('active');
            });
        }
        
        async function endFast(showConfirm = true) {
            if (!currentFast) return;
            
            const now = new Date();
            const elapsed = now - new Date(currentFast.startTime);
            const hours = (elapsed / (1000 * 60 * 60)).toFixed(1);
            
            if (showConfirm) {
                if (!confirm(`End your fast now?\n\nTotal duration: ${hours} hours`)) {
                    return;
                }
            }
            
            currentFast.endTime = now.toISOString();
            currentFast.duration = parseFloat(hours);
            currentFast.endWeight = profile.weight;
            currentFast.maxZone = getZoneName(currentFast.duration);
            
            // Add to history
            fastHistory.unshift(currentFast);
            await saveToFirebase('history', fastHistory);
            
            // Clear current fast
            currentFast = null;
            await database.ref(`users/${currentUser.uid}/currentFast`).remove();
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            if (showConfirm) {
                alert(`Fast completed! ${hours} hours\n\nGreat job! Your fast has been saved to history.`);
            }
            
            showNoFastState();
            updateHistoryDisplay();
            updateStatisticsDisplay();
        }
        
        async function cancelFast() {
            if (!currentFast) return;
            
            const now = new Date();
            const elapsed = now - new Date(currentFast.startTime);
            const hours = (elapsed / (1000 * 60 * 60)).toFixed(1);
            
            if (!confirm(`Cancel this fast without saving?\n\nDuration: ${hours} hours\n\nThis fast will NOT be added to your history.`)) {
                return;
            }
            
            // Clear current fast without saving to history
            currentFast = null;
            await database.ref(`users/${currentUser.uid}/currentFast`).remove();
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            alert('Fast cancelled. Not saved to history.');
            
            showNoFastState();
        }
        
        function startTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        function updateTimer() {
            if (!currentFast) return;
            
            const now = new Date();
            const elapsed = now - new Date(currentFast.startTime);
            
            const hours = Math.floor(elapsed / (1000 * 60 * 60));
            const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((elapsed % (1000 * 60)) / 1000);
            
            document.getElementById('timer').textContent = 
                `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            const totalHours = hours + minutes/60;
            document.getElementById('hours-fasted').textContent = hours;
            
            const bmr = calculateBMR(profile);
            const caloriesBurned = Math.round((bmr / 24) * totalHours);
            document.getElementById('calories-burned').textContent = caloriesBurned;
            
            updateZones(totalHours);
            updateInsights(totalHours);
        }
        
        function calculateBMR(profile) {
            const weightKg = profile.weight / 2.205;
            const heightCm = profile.height * 2.54;
            
            if (profile.gender === 'male') {
                return (10 * weightKg) + (6.25 * heightCm) - (5 * profile.age) + 5;
            } else {
                return (10 * weightKg) + (6.25 * heightCm) - (5 * profile.age) - 161;
            }
        }
        
        function updateZones(totalHours) {
            const zones = [
                { id: 'zone-anabolic', start: 0, end: 4, name: 'Anabolic' },
                { id: 'zone-catabolic', start: 4, end: 12, name: 'Catabolic' },
                { id: 'zone-fatburn', start: 12, end: 16, name: 'Fat Burning' },
                { id: 'zone-ketosis', start: 16, end: 24, name: 'Ketosis' },
                { id: 'zone-deep', start: 24, end: Infinity, name: 'Deep Ketosis' }
            ];
            
            let currentZoneName = 'Anabolic';
            
            zones.forEach(zone => {
                const element = document.getElementById(zone.id);
                element.classList.remove('active', 'completed', 'pending');
                
                if (totalHours >= zone.start && totalHours < zone.end) {
                    element.classList.add('active');
                    currentZoneName = zone.name;
                } else if (totalHours >= zone.end) {
                    element.classList.add('completed');
                } else {
                    element.classList.add('pending');
                }
            });
            
            document.getElementById('current-zone').textContent = currentZoneName;
        }
        
        function getZoneName(hours) {
            if (hours >= 24) return 'Deep Ketosis';
            if (hours >= 16) return 'Ketosis';
            if (hours >= 12) return 'Fat Burning';
            if (hours >= 4) return 'Catabolic';
            return 'Anabolic';
        }
        
        function updateInsights(totalHours) {
            let status = '';
            let recommendation = '';
            
            if (totalHours < 4) {
                status = 'Your body is in the early digestion phase. Insulin is elevated as nutrients are being absorbed.';
                recommendation = 'Stay hydrated with water. Your body is still processing your last meal.';
            } else if (totalHours < 12) {
                status = 'Blood sugar and insulin levels are dropping. Your body is beginning to shift from glucose to stored glycogen.';
                recommendation = 'Light hunger is normal. Black coffee, tea, or sparkling water can help. Gentle movement like walking aids fat mobilization.';
            } else if (totalHours < 16) {
                status = 'Glycogen stores are depleted. Your body is actively burning fat and producing ketones for fuel.';
                recommendation = 'Mental clarity may increase. Consider light exercise. Stay hydrated and supplement electrolytes if needed.';
            } else if (totalHours < 24) {
                status = 'You\'re in ketosis! Ketone bodies are your primary fuel. Autophagy (cellular cleanup) is ramping up.';
                recommendation = 'Peak fat burning zone. Mental focus should be excellent. Monitor energy levels and break fast if feeling weak.';
            } else {
                status = 'Deep ketosis achieved. Autophagy is at its peak. Growth hormone levels significantly elevated.';
                recommendation = 'Impressive! You\'re getting maximum cellular benefits. Consider your goals and energy - extended fasts should be done with care.';
            }
            
            document.getElementById('insight-status').textContent = status;
            document.getElementById('insight-recommendation').textContent = recommendation;
            
            const fatMass = profile.weight * (profile.bodyFat / 100);
            const totalEnergyAvailable = Math.round(fatMass * 3500);
            document.getElementById('insight-composition').textContent = 
                `You have approximately ${Math.round(fatMass)} lbs of fat mass (~${(totalEnergyAvailable/1000).toFixed(0)}k calories) available for fuel. Your body is well-equipped for extended fasting.`;
        }
        
        function updateProfileDisplay() {
            const bmi = ((profile.weight / 2.205) / Math.pow(profile.height * 0.0254, 2)).toFixed(1);
            const heightFeet = Math.floor(profile.height / 12);
            const heightInches = profile.height % 12;
            
            document.getElementById('current-weight').textContent = `${profile.weight} lbs`;
            document.getElementById('current-height').textContent = `${heightFeet}'${heightInches}"`;
            document.getElementById('current-bodyfat').textContent = `${profile.bodyFat}%`;
            document.getElementById('current-bmi').textContent = bmi;
        }
        
        async function saveProfile() {
            profile.weight = parseFloat(document.getElementById('profile-weight').value);
            profile.height = parseFloat(document.getElementById('profile-height').value);
            profile.bodyFat = parseFloat(document.getElementById('profile-bodyfat').value);
            profile.age = parseInt(document.getElementById('profile-age').value);
            profile.gender = document.getElementById('profile-gender').value;
            
            await saveToFirebase('profile', profile);
            updateProfileDisplay();
            
            const alertDiv = document.getElementById('profile-alert');
            alertDiv.textContent = 'Profile saved and synced to cloud!';
            alertDiv.classList.add('show');
            setTimeout(() => alertDiv.classList.remove('show'), 3000);
        }
        
        function updateHistoryDisplay() {
            const container = document.getElementById('fast-history-list');
            
            if (fastHistory.length === 0) {
                container.innerHTML = '<div class="no-fast-state"><h3>No Fasts Yet</h3><p>Start your first fast to see it here</p></div>';
                return;
            }
            
            container.innerHTML = fastHistory.map((fast, index) => {
                const startDate = new Date(fast.startTime);
                const endDate = new Date(fast.endTime);
                const zoneClass = getZoneClass(fast.maxZone);
                
                return `
                    <div class="fast-entry">
                        <div class="fast-details">
                            <div class="fast-date">
                                ${startDate.toLocaleDateString()} - ${endDate.toLocaleDateString()}
                            </div>
                            <div class="fast-duration">${fast.duration} hours</div>
                            <span class="fast-zone ${zoneClass}">${fast.maxZone}</span>
                            ${fast.startWeight !== fast.endWeight ? 
                                `<div style="font-size: 0.9em; color: #666; margin-top: 5px;">
                                    ${fast.startWeight} lbs ‚Üí ${fast.endWeight} lbs 
                                    (${(fast.endWeight - fast.startWeight).toFixed(1)} lbs)
                                </div>` : ''}
                        </div>
                        <div class="fast-actions">
                            <button class="btn-secondary btn-small" onclick="viewFastDetails(${index})">üëÅÔ∏è View</button>
                            <button class="btn-danger btn-small" onclick="deleteFast(${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getZoneClass(zoneName) {
            const map = {
                'Anabolic': 'zone-badge-anabolic',
                'Catabolic': 'zone-badge-catabolic',
                'Fat Burning': 'zone-badge-fatburn',
                'Ketosis': 'zone-badge-ketosis',
                'Deep Ketosis': 'zone-badge-deep'
            };
            return map[zoneName] || 'zone-badge-anabolic';
        }
        
        function viewFastDetails(index) {
            const fast = fastHistory[index];
            const startDate = new Date(fast.startTime);
            const endDate = new Date(fast.endTime);
            
            let details = `Fast #${fastHistory.length - index}\n\n`;
            details += `Started: ${startDate.toLocaleString()}\n`;
            details += `Ended: ${endDate.toLocaleString()}\n`;
            details += `Duration: ${fast.duration} hours\n`;
            details += `Max Zone: ${fast.maxZone}\n\n`;
            details += `Weight: ${fast.startWeight} ‚Üí ${fast.endWeight} lbs\n`;
            details += `Change: ${(fast.endWeight - fast.startWeight).toFixed(1)} lbs\n`;
            
            if (fast.notes && fast.notes.length > 0) {
                details += `\nNotes:\n${fast.notes.map(n => `- ${n.text} (${new Date(n.time).toLocaleString()})`).join('\n')}`;
            }
            
            alert(details);
        }
        
        async function deleteFast(index) {
            if (!confirm('Delete this fast from history?')) return;
            
            fastHistory.splice(index, 1);
            await saveToFirebase('history', fastHistory);
            updateHistoryDisplay();
            updateStatisticsDisplay();
        }
        
        function updateStatisticsDisplay() {
            if (fastHistory.length === 0) {
                document.getElementById('stat-total-fasts').textContent = '0';
                document.getElementById('stat-streak').textContent = '0';
                document.getElementById('stat-avg-duration').textContent = '0h';
                document.getElementById('stat-longest').textContent = '0h';
                document.getElementById('stat-total-hours').textContent = '0';
                document.getElementById('stat-total-days').textContent = '0';
                return;
            }
            
            document.getElementById('stat-total-fasts').textContent = fastHistory.length;
            
            let streak = 1;
            for (let i = 0; i < fastHistory.length - 1; i++) {
                const currentDate = new Date(fastHistory[i].endTime).toDateString();
                const nextDate = new Date(fastHistory[i + 1].endTime).toDateString();
                
                const daysDiff = Math.floor((new Date(currentDate) - new Date(nextDate)) / (1000 * 60 * 60 * 24));
                if (daysDiff <= 1) {
                    streak++;
                } else {
                    break;
                }
            }
            document.getElementById('stat-streak').textContent = streak;
            
            const totalHours = fastHistory.reduce((sum, fast) => sum + fast.duration, 0);
            const avgDuration = (totalHours / fastHistory.length).toFixed(1);
            document.getElementById('stat-avg-duration').textContent = `${avgDuration}h`;
            
            const longest = Math.max(...fastHistory.map(f => f.duration));
            document.getElementById('stat-longest').textContent = `${longest.toFixed(1)}h`;
            
            document.getElementById('stat-total-hours').textContent = totalHours.toFixed(1);
            document.getElementById('stat-total-days').textContent = (totalHours / 24).toFixed(1);
            
            document.getElementById('stat-start-weight').textContent = `${profile.startWeight} lbs`;
            document.getElementById('stat-current-weight').textContent = `${profile.weight} lbs`;
            document.getElementById('stat-weight-lost').textContent = `${(profile.startWeight - profile.weight).toFixed(1)} lbs`;
            
            const startBMI = ((profile.startWeight / 2.205) / Math.pow(profile.height * 0.0254, 2));
            const currentBMI = ((profile.weight / 2.205) / Math.pow(profile.height * 0.0254, 2));
            document.getElementById('stat-bmi-change').textContent = (currentBMI - startBMI).toFixed(1);
            
            const fatBurnCount = fastHistory.filter(f => f.duration >= 12).length;
            const ketosisCount = fastHistory.filter(f => f.duration >= 16).length;
            const deepCount = fastHistory.filter(f => f.duration >= 24).length;
            
            const maxCount = Math.max(fatBurnCount, ketosisCount, deepCount, 1);
            
            document.getElementById('progress-fatburn').style.width = `${(fatBurnCount / maxCount) * 100}%`;
            document.getElementById('progress-fatburn').textContent = `${fatBurnCount} times`;
            
            document.getElementById('progress-ketosis').style.width = `${(ketosisCount / maxCount) * 100}%`;
            document.getElementById('progress-ketosis').textContent = `${ketosisCount} times`;
            
            document.getElementById('progress-deep').style.width = `${(deepCount / maxCount) * 100}%`;
            document.getElementById('progress-deep').textContent = `${deepCount} times`;
        }
        
        function openNoteModal() {
            document.getElementById('note-text').value = '';
            document.getElementById('note-modal').classList.add('show');
        }
        
        function openGoalModal() {
            document.getElementById('goal-hours').value = fastGoal;
            document.getElementById('goal-modal').classList.add('show');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        async function saveNote() {
            const noteText = document.getElementById('note-text').value.trim();
            if (!noteText || !currentFast) return;
            
            if (!currentFast.notes) currentFast.notes = [];
            currentFast.notes.push({
                text: noteText,
                time: new Date().toISOString()
            });
            
            await saveToFirebase('currentFast', currentFast);
            closeModal('note-modal');
            alert('Note saved and synced!');
        }
        
        async function saveGoal() {
            fastGoal = parseInt(document.getElementById('goal-hours').value);
            if (currentFast) {
                currentFast.goal = fastGoal;
                await saveToFirebase('currentFast', currentFast);
            }
            closeModal('goal-modal');
            alert(`Goal set to ${fastGoal} hours!`);
        }
        
        function exportToExcel() {
            if (fastHistory.length === 0) {
                alert('No fasting data to export yet!');
                return;
            }
            
            const fastData = fastHistory.map((fast, index) => ({
                'Fast #': fastHistory.length - index,
                'Start Date': new Date(fast.startTime).toLocaleDateString(),
                'Start Time': new Date(fast.startTime).toLocaleTimeString(),
                'End Date': new Date(fast.endTime).toLocaleDateString(),
                'End Time': new Date(fast.endTime).toLocaleTimeString(),
                'Duration (hrs)': fast.duration,
                'Max Zone': fast.maxZone,
                'Start Weight': fast.startWeight,
                'End Weight': fast.endWeight,
                'Weight Change': (fast.endWeight - fast.startWeight).toFixed(1),
                'Notes': fast.notes ? fast.notes.map(n => n.text).join('; ') : ''
            }));
            
            const stats = [
                ['Statistic', 'Value'],
                ['Total Fasts', fastHistory.length],
                ['Average Duration (hrs)', (fastHistory.reduce((s, f) => s + f.duration, 0) / fastHistory.length).toFixed(1)],
                ['Longest Fast (hrs)', Math.max(...fastHistory.map(f => f.duration)).toFixed(1)],
                ['Total Hours Fasted', fastHistory.reduce((s, f) => s + f.duration, 0).toFixed(1)],
                ['Starting Weight', profile.startWeight],
                ['Current Weight', profile.weight],
                ['Weight Lost', (profile.startWeight - profile.weight).toFixed(1)]
            ];
            
            const wb = XLSX.utils.book_new();
            
            const ws1 = XLSX.utils.json_to_sheet(fastData);
            XLSX.utils.book_append_sheet(wb, ws1, 'Fast Log');
            
            const ws2 = XLSX.utils.aoa_to_sheet(stats);
            XLSX.utils.book_append_sheet(wb, ws2, 'Statistics');
            
            const filename = `Fasting_Tracker_Export_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, filename);
            
            alert(`Excel file exported successfully!\n\nFilename: ${filename}`);
        }
        
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        }
    </script>
</body>
</html>